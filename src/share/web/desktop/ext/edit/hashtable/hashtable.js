// 

ECMAScript.Extend('dom',function(ecma){this.getAnchorsByRel=function(name){var rootNode=ecma.dom.getBody();var links=ecma.dom.getElementsByTagName(rootNode,'A');var result=[];for(var i=0,node;node=links[i];i++){var rel=ecma.dom.getAttribute(node,'rel');if(rel==name){result.push(node);}}
return result;};this.getScrollableParent=function(elem){elem=elem.parentNode;var elemScroll=null;var body=ecma.dom.getBody();while(!elemScroll&&elem){var overflow=ecma.dom.getStyle(elem,'overflow');if(overflow&&overflow.match(/auto|scroll/i)){elemScroll=elem;}else{elem=elem==body?null:elem.parentNode;}}
return elemScroll||body;};this.scrollTo=function(elem){var se=ecma.dom.getScrollableParent(elem);var sh=ecma.dom.getHeight(se);var st=se.scrollTop;var tt=ecma.dom.getTop(elem)-ecma.dom.getTop(se);var tb=ecma.dom.getBottom(elem)-ecma.dom.getTop(se);if(tb>(st+sh)||(tt<st)){se.scrollTop=ecma.util.asInt(tt-(sh/2));}};});js.extend('lsn.hashtable.model',function(js){var CNode=js.data.Node;var CAction=js.action.ActionDispatcher;this.Item=function(dnode){CAction.apply(this);var data={attributes:{autoselect:false},values:{},dnode:dnode};CNode.apply(this,[data]);dnode.iterate(function(key,value){data.values[key]=value.toString();value.addActionListener('change',this.doDataChanged,this);},this);};var Item=this.Item.prototype=js.lang.createMethods(CAction,CNode);Item.unload=function(){this.data.dnode.iterate(function(key,value){value.removeActionListener('change',this.doDataChanged,this);},this);};Item.doDataChanged=function(action,node){var key=node.getKey();this.data.values[key]=node.getValue();this.dispatchAction('change',this);};Item.reset=function(){this.data.dnode.iterate(function(key,value){this.data.values[key]=value;},this);};Item.select=function(){this.removeAttribute('autoselect');this.executeAction('select',this);};Item.deselect=function(){this.executeAction('deselect',this);};Item.getAttribute=function(name){return this.data.attributes[name];};Item.setAttribute=function(name,value){return this.data.attributes[name]=value;};Item.removeAttribute=function(name){delete this.data.attributes[name];};Item.getDataNode=function(){return this.data.dnode;};Item.getValue=function(key){return this.data.values[key];};Item.setValue=function(key,value){return this.data.values[key]=value;};Item.getKey=function(){return this.data.dnode.getKey();};Item.getDisplayField=function(){return this.data.dnode.getValue(this.rootNode.meta.name_field);};Item.getDisplayName=function(){var field=this.getDisplayField();return field?field.toString():this.getKey();};Item.lower=function(){if(this.parentNode&&this.previousSibling){this.parentNode.insertBefore(this,this.previousSibling);this.dispatchAction('lower');}};Item.raise=function(){if(this.parentNode&&this.nextSibling){this.parentNode.insertAfter(this,this.nextSibling);this.dispatchAction('raise');}};Item.isModified=function(){for(var key in this.data.values){var myValue=this.data.values[key];var dbValue=this.data.dnode.getString(key);if(myValue!=dbValue)return true;}
return false;};Item.store=function(commands){commands.push(['store',this.getDataNode().getAddress(),this.data.values]);};Item.remove=function(){this.parentNode.removeChild(this);this.dispatchAction('remove',this);};});js.extend('lsn.hashtable.model',function(js){var CNode=js.data.Node;var CAction=js.action.ActionDispatcher;var _schemaKey='.schema';this.Root=function(){CNode.apply(this);CAction.apply(this);this.meta=null;this.db=js.hubb.getInstance();this.selected=null;this.indexOffset=0;this.targetAddress=null;this.dataAddress=null;this.dataRoot=null;this.als=[];this.autoselect=null;};var Root=this.Root.prototype=js.lang.createMethods(CNode,CAction);Root.createNode=function(dnode){var node=new js.lsn.hashtable.model.Item(dnode);node.addActionListener('select',this.doSelect,this);node.addActionListener('deselect',this.doDeselect,this);node.addActionListener('raise',this.incrementOffset,this);node.addActionListener('lower',this.decrementOffset,this);return node;};Root.load=function(targetAddress,defaultSchemaAddress){this.db.fetch(targetAddress,[this.onLoad,this,[defaultSchemaAddress]]);};Root.onLoad=function(dnode,defaultSchemaAddress){try{if(dnode.getType()==='directory'){throw'Editing a directory of hash files is not supported';}
this.targetAddress=dnode.getAddress();this.target=dnode;this.db.fetch(js.data.addr_join(this.targetAddress,_schemaKey),[this.onLoadSchema,this,[defaultSchemaAddress]]);}catch(ex){this.loadComplete(ex);}};Root.onLoadSchema=function(dnode,defaultSchemaAddress){try{if(!dnode){if(defaultSchemaAddress){this.db.fetch(defaultSchemaAddress,[this.onLoadSchema,this]);return;}}
if(dnode.getType()=='data-scalar'){this.db.fetch(dnode.toString(),[this.onLoadSchema,this]);return;}
this.schemaAddress=dnode.getAddress();this.meta=dnode.toObject();if(this.meta.root_subkey){this.dataAddress=js.data.addr_join(this.targetAddress,this.meta.root_subkey);this.db.fetch(this.dataAddress,[this.onLoadRoot,this]);}else{this.onLoadRoot(this.target);}}catch(ex){this.loadComplete(ex);}};Root.onLoadRoot=function(dnode){try{this.dataRoot=dnode;this.dataAddress=dnode.getAddress();this.dataRoot.iterate(function(name,dnode){if(name===_schemaKey)return;this.appendChild(dnode);},this);this.als.push(dnode.addActionListener('create',this.onAddNode,this));this.als.push(dnode.addActionListener('remove',this.onRemoveNode,this));this.loadComplete();}catch(ex){this.loadComplete(ex);}};Root.loadComplete=function(ex){if(ex){this.dispatchAction('loadError',ex);}else{this.dispatchAction('load',this);}};Root.createNewKey=function(){return this.dataRoot.getType()=='data-array'?'<next>':js.util.randomId();};Root.fetchNewNode=function(){var name=this.createNewKey();var toAddress=js.data.addr_join(this.dataAddress,name);var newItem=this.meta.new_item;var fromAddress=typeof(newItem)==='string'?newItem.indexOf('/')==0?newItem:js.data.addr_join(this.schemaAddress,newItem):js.data.addr_join(this.schemaAddress,'new_item');this.db.copy(fromAddress,toAddress,[this.onFetchNewNode,this,[name]]);};Root.onFetchNewNode=function(result,name){if(this.hasChildNodes()){var dnode=name==='<next>'?result.getValue(result.length-1):result.getValue(name);this.autoselect=dnode;}};Root.onAdopt=function(node){if(this.autoselect&&this.autoselect===node.getDataNode()){node.setAttribute('autoselect',true);this.autoselect=null;}
this.dispatchAction('create',node);};Root.onOrphan=function(node){this.dispatchAction('remove',node);};Root.onAddNode=function(action,dnode){this.appendChild(dnode);};Root.onRemoveNode=function(action,dnode){var node=this.firstChild;while(node){if(node.getDataNode()===dnode){this.removeChild(node);break;}
node=node.nextSibling;}};Root.doSelect=function(action,node){if(this.selected)this.selected.deselect();this.selected=node;this.executeAction('select',node);};Root.doDeselect=function(action,node){this.reset();this.selected=null;this.executeAction('deselect',node);};Root.getSelected=function(){return this.selected;};Root.decrementOffset=function(){this.indexOffset--;};Root.incrementOffset=function(){this.indexOffset++;};Root.reset=function(){var l=this.indexOffset;for(var i=0;i>l;i--){this.selected.raise();}
for(var i=0;i<l;i++){this.selected.lower();}
if(this.selected)this.selected.reset();};Root.isModified=function(){if(this.indexOffset!=0)return true;if(this.selected)return this.selected.isModified();};Root.store=function(cb){var commands=[];if(this.selected&&this.selected.isModified())this.selected.store(commands);if(this.indexOffset!=0){var indexes=[];for(var node=this.firstChild;node;node=node.nextSibling){indexes.push(node.getDataNode().getKey());}
commands.push(['reorder',this.dataAddress,indexes]);}
this.db.batch(commands,[this.onStore,this,[cb]]);};Root.onStore=function(results,cb){this.indexOffset=0;if(cb)js.lang.callback(cb,this,[results]);this.dispatchAction('stored');};Root.removeSelected=function(){var node=this.selected;node.reset();node.deselect();var addr=node.getDataNode().getAddress();this.db.remove(addr,[this.onRemove,this,[node]]);};Root.onRemove=function(dnode,node){var sibling=node.previousSibling||node.nextSibling;node.setAttribute('select_sibling',sibling);node.remove();};Root.unload=function(){for(var i=0,al;al=this.als[i];i++){al.remove();}
var node=this.firstChild;while(node){node.unload();node=node.nextSibling;}};});js.extend('lsn.hashtable.view',function(js){var CAction=js.action.ActionDispatcher;this.View=function(app){CAction.apply(this);this.app=app;};var View=this.View.prototype=js.lang.createMethods(CAction);View.attach=function(){};View.detach=function(){};});js.extend('lsn.hashtable.view',function(js){var CAction=js.action.ActionDispatcher;this.ListItem=function(app,node){CAction.apply(this);this.app=app;this.node=node;this.ui=new Object();this.node.addActionListener('select',this.select,this);this.node.addActionListener('deselect',this.deselect,this);this.node.addActionListener('lower',this.doLower,this);this.node.addActionListener('raise',this.doRaise,this);this.node.addActionListener('change',this.doChange,this);this.node.addActionListener('remove',this.doRemove,this);this.createUI();};var ListItem=this.ListItem.prototype=js.lang.createMethods(CAction);ListItem.createUI=function(){this.ui.li=js.dom.createElement('LI.action',{'onClick':[this.onClick,this],'innerHTML':this.node.getDisplayName()});};ListItem.doChange=function(action,node){js.dom.setValue(this.ui.li,node.getDisplayName());};ListItem.getRootElement=function(){return this.ui.li;};ListItem.getNode=function(){return this.node;};ListItem.onClick=function(event){js.dom.stopEvent(event);this.executeAction('click',this);};ListItem.select=function(){js.dom.addClassName(this.ui.li,'sel');this.scrollIntoView();};ListItem.deselect=function(){js.dom.removeClassName(this.ui.li,'sel');};ListItem.doLower=function(action){js.dom.insertBefore(this.ui.li,this.ui.li.previousSibling);this.scrollIntoView();};ListItem.doRaise=function(action){js.dom.insertAfter(this.ui.li,this.ui.li.nextSibling);this.scrollIntoView();};ListItem.scrollIntoView=function(){js.dom.scrollTo(this.ui.li);};ListItem.doRemove=function(){js.dom.removeElement(this.ui.li);};});js.extend('lsn.hashtable.view',function(js){var CView=js.lsn.hashtable.view.View;this.ListView=function(){CView.apply(this,arguments);};var ListView=this.ListView.prototype=js.lang.createMethods(CView);ListView.addItem=function(node){var item=new js.lsn.hashtable.view.ListItem(this.app,node);item.addActionListener('click',this.onItemClick,this);this.app.ui.listView.appendChild(item.getRootElement());};ListView.onItemClick=function(action,item){this.executeAction('select',item);};});js.extend('lsn.hashtable.view',function(js){var CComboBox=js.hubb.ui.ComboBox;this.FileCombo=function(){CComboBox.apply(this);};var FileCombo=this.FileCombo.prototype=js.lang.createMethods(CComboBox);FileCombo.canExpand=function(tnode){return tnode.data.isDirectory();};FileCombo.canDisplay=function(tnode){return tnode.getKey()!='index.hf';};});js.extend('lsn.hashtable.view',function(js){var CView=js.lsn.hashtable.view.View;this.EditView=function(){CView.apply(this,arguments);this.node=undefined;this.form=new js.lsn.hashtable.edit.Properties(this.app);this.form.addActionListener('onChange',this.onFieldChange,this);};var EditView=this.EditView.prototype=js.lang.createMethods(CView);EditView.attach=function(){CView.prototype.attach.apply(this,arguments);js.dom.replaceChildren(this.app.ui.editView,[this.form.getRootElement()]);};EditView.detach=function(){if(this.form&&this.form.fields){for(var i=0,field;field=this.form.fields[i];i++){field.detach();}}};EditView.onFieldChange=function(action,field){this.node.setValue(field.getName(),field.getValue());};EditView.select=function(node){js.dom.removeClassName(this.app.ui.editMenu,'hidden');js.dom.removeClassName(this.app.ui.editView,'hidden');this.node=node;for(var i=0,field;field=this.form.fields[i];i++){var name=field.getName();if(!js.util.defined(name))continue;var storedValue=this.node.getValue(name);if(js.util.defined(storedValue)){var serialized=storedValue.toString();if(serialized!==''){field.setValue(serialized);}else{this.node.setValue(name,field.getValue());}}else{field.reset();this.node.setValue(name,field.getValue());}}
if(this.node.isModified()){this.dispatchAction('fixup');}};EditView.deselect=function(){js.dom.addClassName(this.app.ui.editMenu,'hidden');js.dom.addClassName(this.app.ui.editView,'hidden');this.reset();};EditView.reset=function(){this.form.reset();};});js.extend('lsn.hashtable.edit',function(js){var CDispatcher=js.action.ActionDispatcher;this.Field=function(spec){CDispatcher.apply(this);this.adaptor=null;this.labelElements=null;this.inputElements=null;this.type=null;this.display=null;this.original=null;this.id=null;this.build(spec);};var Field=this.Field.prototype=js.lang.createMethods(CDispatcher);Field.build=function(spec){this.model=js.util.clone(spec);this.type=this.mapType(this.model.type);this.display=this.mapDisplay(this.type);this.id=js.util.randomId(this.type+'_');this.labelElements=this.createLabel();this.inputElements=this.createInput();};Field.mapType=function(type){return type||'text';};Field.mapDisplay=function(type){return type==='heading'?'heading':type==='hidden'?'hidden':'field';};Field.getDisplay=function(){return this.display;};Field.hasChanged=function(){var value=this.getValue();return this.type=='password'&&value=='*****'?false:value==''&&!js.util.defined(this.original)?false:value!=this.original;};Field.isHidden=function(){return this.type=='hidden';};Field.getName=function(){return this.model.name;};Field.getValue=function(){return this.adaptor.serialize();};Field.setValue=function(value){return this.adaptor.deserialize(value);};Field.getLabelElements=function(){return this.labelElements;};Field.getInputElements=function(){return this.inputElements;};Field.createLabel=function(){var elems=[];if(this.model.label){elems.push(js.dom.createElement('LABEL',{'for':this.id},['#text='+this.model.label]));}
return elems;};Field.createInput=function(){var elems=[];var model=this.model;var tag=null;var adaptorClass=undefined;var attrs={'id':this.id,'class':this.type,'name':model.name};var cnodes=[];var initialValue=model.value;var adaptorArgs=[];switch(this.type){case'heading':adaptorClass=js.lsn.hashtable.edit.InputStatic;break;case'text':adaptorClass=js.lsn.hashtable.edit.InputText;var maxLength=js.util.defined(model.maxlength)?model.maxlength:255;tag='input';attrs.type='text';attrs.maxlength=maxLength;break;case'textarea':adaptorClass=js.lsn.hashtable.edit.InputText;tag='textarea';break;case'password':adaptorClass=js.lsn.hashtable.edit.InputText;tag='input';initialValue=model.value?'*****':'';attrs.type='password';break;case'date':adaptorClass=js.lsn.forms.InputDate;tag='input';attrs.type='text';break;case'hidden':tag='input';attrs.type='hidden';break;case'yesno':tag='SELECT';var opt_y={'value':'1','innerHTML':'Yes'};var opt_n={'value':'0','innerHTML':'No'};var sel=model.value?opt_y:opt_n;sel.selected='selected';cnodes.push('OPTION',opt_y);cnodes.push('OPTION',opt_n);break;case'select':tag='SELECT';adaptorClass=js.lsn.hashtable.edit.InputSelect;adaptorArgs.push(model.options);break;case'join':tag='SELECT';adaptorClass=js.lsn.hashtable.edit.InputSelectTable;adaptorArgs.push(model.dataSource);adaptorArgs.push(model.defaultSchema);break;case'currency':case'decimal':adaptorClass=js.lsn.forms.InputDecimal;tag='input';attrs.type='text';break;case'integer':adaptorClass=js.lsn.hashtable.edit.InputInteger;tag='input';attrs.type='text';break;case'checkbox':case'radio':case'file':case'time':case'datetime':case'integer':default:throw'Not a known form input control type: '+this.type;}
var elem=tag?js.dom.createElement(tag,attrs,cnodes):null;adaptorArgs.unshift(elem);if(!adaptorClass)adaptorClass=js.lsn.forms.InputBase;this.adaptor=js.lang.createObject(adaptorClass,adaptorArgs);this.adaptor.addActionListener('*',function(action,adaptor){this.executeAction(action,this);},this);this.adaptor.sync();if(initialValue){this.adaptor.deserialize(initialValue);}
if(elem)elems.push(elem);if(this.model.description){elems.push(js.dom.createElement('P.description',{'innerHTML':this.model.description}));}
return elems;};Field.reset=function(){return this.adaptor.reset();};Field.detach=function(){return this.adaptor.detach();};});ECMAScript.Extend('lsn.hashtable.edit',function(ecma){var CInputBase=js.lsn.forms.InputBase;var _proto=ecma.lang.createMethods(CInputBase);this.InputInteger=function(elem){CInputBase.apply(this,[elem]);this.value=this.emptyValue=new Number();};this.InputInteger.prototype=_proto;_proto.marshal=function(dataValue){return dataValue.toFixed();};_proto.unmarshal=function(ctrlValue){return new Number(ctrlValue);};_proto.deserialize=function(storedValue){this.setValue(new Number(storedValue));return this;};_proto.serialize=function(){return this.getValue().valueOf();};});js.extend('lsn.hashtable.edit',function(js){var CInputBase=js.lsn.forms.InputBase;this.InputStatic=function(){CInputBase.apply(this);this.value=this.emptyValue=null;};var InputStatic=this.InputStatic.prototype=js.lang.createMethods(CInputBase);InputStatic.getValue=function(){return this.value;};InputStatic.setValue=function(value){this.value=value;return this;};InputStatic.read=function(){return this;};InputStatic.write=function(){return this;};});js.extend('lsn.hashtable.edit',function(js){var CInputBase=js.lsn.forms.InputBase;this.InputSelect=function(elem,dataSource){CInputBase.apply(this,[elem]);this.load(dataSource);};var InputSelect=this.InputSelect.prototype=js.lang.createMethods(CInputBase);InputSelect.load=function(dataSource){if(js.util.isObject(dataSource)){this.createOptions(dataSource);}else{js.hubb.getInstance().fetch(dataSource,[this.onLoad,this]);}};InputSelect.onLoad=function(dnode){this.createOptions(dnode.toObject());};InputSelect.createOptions=function(options){if(js.util.isAssociative(options)){for(var value in options){this.addItem(value,options[value]);}}else if(js.util.isArray(options)){for(var i=0,opt;opt=options[i];i++){if(typeof(opt)==='string'){this.addItem(opt,opt);}else{this.addItem(opt.value,opt.text);}}}
if(this.value!==this.emptyValue)this.write();};InputSelect.addItem=function(value,text){var option=js.dom.createElement('OPTION',{'value':value,'innerHTML':text});js.dom.appendChild(this.elem,option);};});js.extend('lsn.hashtable.edit',function(js){var CInputBase=js.lsn.forms.InputBase;this.InputSelectTable=function(elem,dataSource){CInputBase.apply(this,[elem]);this.value=this.emptyValue=null;this.options=[];this.map=[];this.table=new js.lsn.hashtable.model.Root();this.als=[this.table.addActionListener('load',this.onTableLoad,this),this.table.addActionListener('create',this.doAddItem,this),this.table.addActionListener('remove',this.doRemoveItem,this)];this.table.load(dataSource);};var InputSelectTable=this.InputSelectTable.prototype=js.lang.createMethods(CInputBase);InputSelectTable.onTableLoad=function(action,table){if(this.value!==this.emptyValue)this.write();};InputSelectTable.doAddItem=function(action,item){var title=item.getDisplayField();var option=js.dom.createElement('OPTION',{'value':item.getKey(),'innerHTML':title.toString()});this.map.push([item,option,title]);this.als.push(title.addActionListener('change',this.doUpdateTitle,this,[option]));js.dom.appendChild(this.elem,option);};InputSelectTable.doRemoveItem=function(action,item){var optionValue=null;for(var i=0,pair;pair=this.map[i];i++){if(pair[0]===item){var option=pair[1];optionValue=js.dom.getAttribute(option,'value');js.dom.removeElement(option);break;}}
if(optionValue!==null&&this.value===optionValue){try{this.setValue(this.map[0][0].getKey());}catch(ex){this.reset();}}};InputSelectTable.doUpdateTitle=function(action,title){for(var i=0,pair;pair=this.map[i];i++){if(pair[2]===title){var option=pair[1];option.innerHTML=title.toString();break;}}};InputSelectTable.detach=function(){CInputBase.prototype.detach.apply(this);for(var i=0,al;al=this.als[i];i++){al.remove();}};});js.extend('lsn.hashtable.edit',function(js){var CDispatcher=js.action.ActionDispatcher;this.Properties=function(app){CDispatcher.call(this);this.app=app;this.ui=null;this.fields=null;};var Properties=this.Properties.prototype=js.lang.createMethods(CDispatcher);Properties.getRootElement=function(){if(!this.fields)this.fields=this.createFields();if(!this.ui)this.ui=this.createUI();return this.ui.root;};Properties.createFields=function(){var fields=[];for(var i=0,spec;spec=this.app.schema.fields[i];i++){fields.push(new js.lsn.hashtable.edit.Field(spec));}
return fields;};Properties.createUI=function(){var ui={'root':js.dom.createElement('DIV#fields')};var firstField=true;for(var i=0,field;field=this.fields[i];i++){switch(field.getDisplay()){case'heading':js.dom.appendChild(ui.root,js.dom.createElement('H3#heading',{'innerHTML':field.getValue()}));firstField=true;break;case'field':field.addActionListener('change',this.executeAction,this);var div=js.dom.createElement('DIV#field',['DIV#label',field.getLabelElements(),'DIV#input',field.getInputElements()]);if(firstField){js.dom.addClassName(div,'first');firstField=false;}
js.dom.appendChild(ui.root,div);break;case'hidden':break;}}
return ui;};Properties.reset=function(){for(var i=0,field;field=this.fields[i];i++){field.reset();}};});js.extend('lsn.hashtable.app',function(js){var CApplication=js.lsn.app.Application;this.Application=function(config){CApplication.apply(this);this.config=config;this.schema=null;this.model=new js.lsn.hashtable.model.Root();this.model.addActionListener('load',this.doModelLoad,this);this.model.addActionListener('loadError',this.doModelLoadError,this);this.model.addActionListener('create',this.doModelCreate,this);this.model.addActionListener('select',this.doModelSelect,this);this.model.addActionListener('deselect',this.doModelDeselect,this);this.model.addActionListener('stored',this.doModelStored,this);this.model.addActionListener('remove',this.doModelRemove,this);this.listView=new js.lsn.hashtable.view.ListView(this);this.listView.addActionListener('select',this.doListSelect,this);this.editView=new js.lsn.hashtable.view.EditView(this);this.editView.addActionListener('fixup',this.doEditFixup,this);};var Application=this.Application.prototype=js.lang.createMethods(CApplication);Application.onPageLoad=function(event){CApplication.prototype.onPageLoad.apply(this,arguments);this.showLoading('Fetching data');this.model.load(this.config.target,this.config.schema);};Application.onPageUnload=function(event){this.listView.detach();this.editView.detach();this.model.unload();};Application.doModelLoad=function(action,model){this.schema=model.meta;if(this.schema){this.listView.attach();this.editView.attach();}
this.hideLoading();if(this.model.firstChild)this.model.firstChild.select();};Application.doModelLoadError=function(action,model){this.hideLoading();this.alert('An error occurred while loading');};Application.doModelCreate=function(action,node){this.listView.addItem(node);if(node.getAttribute('autoselect'))node.select();};Application.doModelSelect=function(action,node){this.editView.select(node);};Application.doModelDeselect=function(action,node){this.editView.deselect();};Application.doModelStored=function(action){this.notify('Saved');};Application.doModelRemove=function(action,node){this.editView.deselect();var sibling=node.getAttribute('select_sibling');if(sibling)sibling.select();};Application.doMenuCreate=function(action){this.model.fetchNewNode();};Application.doListSelect=function(action,item){if(this.model.isModified()){this.confirm('Save changes?',[function(answer,item){if(answer){this.model.store(function(){item.node.select();});}else{item.node.select();}},this,[item]]);}else{item.node.select();}};Application.doEditFixup=function(action){this.notify('Some values have been set to their default and you should save these changes.');};Application.doEditSave=function(action){if(this.model.isModified()){this.model.store();}else{this.notify('Up to date (no save needed).');}};Application.doEditCancel=function(action){this.model.getSelected().deselect();};Application.doEditMoveUp=function(action){this.model.getSelected().lower();};Application.doEditMoveDown=function(action){this.model.getSelected().raise();};Application.doEditDelete=function(action){this.confirm('Delete this item?',[function(yn){if(yn)this.model.removeSelected();},this]);};});