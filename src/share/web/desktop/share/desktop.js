// Livesite (c) Livesite Networks, LLC 2006-2009.

ECMAScript.Extend('lsn.desktop',function(ecma){var baseClass=ecma.lsn.ui.Element;var proto=ecma.lang.createMethods(baseClass);this.Application=function(){baseClass.call(this);};this.Application.prototype=proto;proto.getRootElement=function(){return this.getElement('div_page');};proto.createUI=function(){this.createElement('div_page',[this.createElement('div_head'),this.createElement('div_body'),this.createElement('div_foot')]);ecma.dom.addClassName(this.getElement('div_page'),'pgRoot');ecma.dom.addClassName(this.getElement('div_head'),'pgHead');ecma.dom.addClassName(this.getElement('div_body'),'pgBody');ecma.dom.addClassName(this.getElement('div_foot'),'pgFoot');return this;};proto.alert=function(msg){ecma.window.alert(msg);};proto.setStatus=function(msg,interval){};});ECMAScript.Extend('lsn.desktop',function(ecma){var baseClass=ecma.lsn.Widget;var proto=ecma.lang.createMethods(baseClass);this.Editor=function(uri,props,ui){baseClass.call(this,uri,props);this.props.ui=ui;this.addEvent('show',this.showMenu);};this.Editor.prototype=proto;proto.showMenu=function(){var ui=this.props.ui.menu;var content=this.request.xhr.responseHash.get('head/menu');if(content){ecma.dom.setAttribute(ui,'innerHTML',content);}};});ECMAScript.Extend('lsn.desktop',function(ecma){var _tabset=null;var _hub=null;this.init=function(tabs){_tabset=new js.res.Tabset('lh-tabs','rh-tabs','workspace');if(tabs){tabs.iterate(function(idx,val){this.createTab(val.toObject());},this);}};this.createTab=function(props){return _tabset.createTab(props);};this.getTab=function(name){return _tabset.getTab(name);};this.browse=function(tnode,newTab){var tabId=newTab?typeof(newTab)==='boolean'?ecma.util.randomId('tab'):newTab:'browse';var addr=tnode.data.getAddress();var name=ecma.data.addr_name(addr)||addr;var props={'id':tabId,'src':'/desktop/ext/browse/index.html?a='+addr,'icon':tnode.data.getIcon(),'name':name,'side':'right','canClose':true};var tab=this.getTab(tabId);if(tab){try{tab.rename(name,tnode.data.getIcon());var tview=tab.getWindow().js.local.tview;tview.setRootAddress(addr);tview.select(addr);tab.select();return tab;}catch(ex){}}
return this.createTab(props);};this.logout=function(){new ecma.http.Request('/res/login/module.pm/logout',{onSuccess:function(){window.top.location.reload()}}).submit();};});