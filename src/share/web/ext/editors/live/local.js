// 

js.extend('ext.editors.live',function(js){var CScreen=js.ext.share.Screen;this.Screen=function(){CScreen.apply(this,arguments);this.hasInitialized=false;this.panels=new js.ext.share.ui.SwitchList('ext-editors-live-area4');this.tabs=new js.ext.share.ui.TabList(this.panels);this.tabs.Tab=js.ext.editors.live.ui.Tab;this.menu=new js.ext.share.ui.menu.PanelMenu(env,this.panels);this.fileSelector=new js.ext.share.FileSelector(this.panels);};var _proto=this.Screen.prototype=js.lang.createMethods(CScreen);_proto.initialize=function(addr){this.menu.load([#:json /ext/editors/live/menu.hf]);this.fileMenu=this.menu.loadItem([#:json ./file-menu.hf],env,this.fileSelector);env.initiators.addLayer('ext-editors-live-menu',this.fileMenu);js.dom.replaceChildren('ext-editors-live-area2',this.menu.getElements());js.dom.replaceChildren('ext-editors-live-area3',this.tabs.getElements());this.fileMenu.attachUI();this.hasInitialized=true;};_proto.load=function(params){var addr;if(params){if(params.addr){addr=params.addr;}else if(params.dnode){addr=params.dnode.getAddress();}}
if(!addr&&!this.panels.getSelected()){addr=env.getPreference('lsn.ext.dde','lastDocument');}
if(!addr)return;if(!this.hasInitialized)this.initialize();var panel=this.panels.get(addr);if(!panel){panel=new js.ext.editors.live.ui.Panel(addr);this.panels.add(panel);}
this.panels.select(panel,addr);};});js.extend('ext.editors.live.ui',function(js){var _package=this;var CAction=js.action.ActionDispatcher;_package.Panel=function(name){CAction.apply(this);this.name=name;this.addr=null;this.dnode=null;this.uiRoot=null;this.createUI();this.alResize=env.layout.addActionListener('onPageResize',this.resize,this);};var _proto=_package.Panel.prototype=js.lang.createMethods(CAction);_proto.getElements=function(){return[this.uiRoot];};_proto.createUI=function(){this.uiToolbar=js.dom.createElement('DIV.dde-layout-toolbar');this.uiFrame=js.dom.createElement('IFRAME.dde-layout-doc',{'name':'docframe','frameborder':'0','scrolling':'yes','src':'about:blank'});this.uiStatus=js.dom.createElement('DIV.dde-layout-statusbar');return this.uiRoot=js.dom.createElement('DIV',[this.uiToolbar,this.uiFrame,this.uiStatus]);};_proto.resize=function(action){};_proto.focus=function(){};_proto.close=function(){js.dom.removeElement(this.uiRoot);this.alResize.remove();this.addr=null;this.dnode=null;this.uiRoot=null;this.executeClassAction('onClose',this);};_proto.getName=function(){return this.name;};_proto.show=function(appendTo,cb){if(!this.uiRoot.parentNode){appendTo.appendChild(this.uiRoot);}
js.dom.setOpacity(this.uiRoot,1);js.dom.setStyles(this.uiRoot,{'z-index':'1','visibility':'visible'});this.resize();this.executeClassAction('onShow',this);if(cb)js.lang.callback(cb);};_proto.hide=function(cb){js.dom.setOpacity(this.uiRoot,0);js.dom.setStyles(this.uiRoot,{'z-index':'-1','visibility':'hidden'});this.executeClassAction('onHide',this);if(cb)js.lang.callback(cb);};_proto.reload=function(addr){this.executeClassAction('onReady',this);};_proto.load=function(addr){if(!addr)return;if(addr===this.addr){this.executeClassAction('onReady',this);}else{this.addr=addr;this.dde=new js.lsn.ext.dde.Application(this.uiRoot,this.uiToolbar,this.uiStatus,this.uiFrame);this.dde.addActionListener('onOpen',this.onEditorOpen,this);this.dde.load(addr);this.executeClassAction('onLoad',this);}}
_proto.onEditorOpen=function(action){this.addr=this.dde.docLoc.pathname;if(/\/$/.test(this.addr)){this.addr+='index.html';}
env.hub.get(this.addr,[this.onGetDataNode,this]);this.dispatchAction('onOpen',this.addr);};_proto.onGetDataNode=function(dnode){this.dnode=dnode;this.executeClassAction('onReady',this);};_proto.getDataNode=function(){return this.dnode;};});js.extend('ext.editors.live.ui',function(js){var _package=this;var CTab=js.ext.share.ui.Tab;_package.Tab=function(selector,target){CTab.apply(this,arguments);this.dnode=null;this.alOpen=target.addActionListener('onOpen',this.onTargetOpen,this);};var _proto=_package.Tab.prototype=js.lang.createMethods(CTab);_proto.onTargetOpen=function(action,addr){if(!addr)return;addr=js.data.addr_normalize(addr);env.hub.get(addr,[function(dnode){this.dnode=dnode;this.updateUI();this.alUpdate=this.dnode.addActionListener('update',this.updateUI,this);},this]);};_proto.updateUI=function(){var addr=this.dnode.getAddress();js.dom.setAttribute(this.uiAnchor,'href',addr);js.dom.setAttribute(this.uiAnchor,'title',addr);js.dom.setAttribute(this.uiIcon,'src',this.dnode.getIcon());js.dom.setValue(this.uiMark,this.dnode.getKey()||'Home');};_proto.removeUI=function(action,target){CTab.prototype.removeUI.call(this);this.alOpen.remove();this.alUpdate.remove();};});js.extend('ext.editors.live',function(js){env.dialogs.register('ext-editors-live-file-open',js.hubb.ui.BrowseDialog,function(){var browseDialog=this;browseDialog.dlg.addEvent('ok',function(){addr=browseDialog.getTarget().getAddress();env.invokeHandler('edit-html-live',addr);});});env.registerHandler('ext-editors-live-file-open',function(action){env.dialogs.get('ext-editors-live-file-open').show();});env.registerHandler('ext-editors-live-file-save',function(action,panel){panel.dde.exec('docSave');});env.registerHandler('ext-editors-live-file-reload',function(action,panel){panel.dde.exec('docRefresh');});env.registerHandler('ext-editors-live-file-close',function(action,panel){if(panel.dde.hasChanged()){if(!confirm('Discard changes?')){return;}}
panel.close();});env.registerHandler('ext-editors-live-file-goto',function(action,panel){panel.dde.exec('docGoto');});env.registerHandler('ext-editors-live-file-mail',function(action,panel){panel.dde.exec('docMail');});env.registerHandler('ext-editors-live-file-view-source',function(action,panel){panel.dde.exec('docViewSource');});});