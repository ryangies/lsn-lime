// Livesite (c) Livesite Networks, LLC 2008-2009.

js.extend('lsn.ext.wireframe.data',function(js){var _tagNameToClassMap={};function normalizeTagName=(tagName){if(!js.util.defined(tagName))return tagName;return tagName.toUpperCase();};this.register=function(tagName,klass){tagName=normalizeTagName(tagName);return _tagNameToClassMap[tagName]=klass;};this.getAllowedTypes=function(){var keys=[];for(var k in _tagNameToClassMap){keys.push(k);}
return keys;};this.createInstance=function(tagName){tagName=normalizeTagName(tagName);var klass=_tagNameToClassMap[tagName];if(!klass){throw'Unhandled tag name: '+tagName;}
return new klass(tagName);};this.fromObject=function(obj){var node=js.lsn.ext.wireframe.data.createInstance(obj.tagName);node.id=obj.id;node.data=obj.data;for(var i=0,child;child=obj.childNodes[i];i++){node.appendChild(this.fromObject(child));}
return node;};});js.extend('lsn.ext.wireframe.data',function(js){var CAction=js.action.ActionDispatcher;var CNode=js.data.Node;this.Node=function(){CAction.apply(this);CNode.apply(this,arguments);};var Node=this.Node.prototype=js.lang.createMethods(CAction,CNode);Node.type='AbstractNode';Node.onAdopt=function(node){this.executeAction('onAdopt',node);};Node.onOrphan=function(node){this.executeAction('onOrphan',node);};Node.getPrecedingNode=function(){var n=undefined;if(this.previousSibling){n=this.previousSibling;while(n.lastChild){n=n.lastChild;}}else{n=this.parentNode;}
return n;};Node.getSucceedingNode=function(){return this.firstChild||this.nextSibling||this.parentNode?this.parentNode.nextSibling:undefined;};Node.toString=js.lang.createAbstractFunction();Node.toObject=function(){var obj={'id':this.id,'tagName':this.tagName,'data':this.data,'childNodes':[]};for(var node=this.firstChild;node;node=node.nextSibling){obj.childNodes.push(node.toObject());}
return obj;};Node.serialize=function(){return js.data.xfr.format(this.toObject());};Node.deserialize=js.lang.createAbstractFunction();Node.canAdopt=js.lang.createAbstractFunction();});js.extend('lsn.ext.wireframe.data',function(js){var CNode=this.Node;this.RootNode=function(typeName){CNode.apply(this);this.tagName='ROOT';};var RootNode=this.RootNode.prototype=js.lang.createMethods(CNode);js.lsn.ext.wireframe.data.register('ROOT',this.RootNode);RootNode.toString=function(){return this.tagName;};RootNode.fromObject=function(obj){this.id=obj.id;this.data=obj.data;this.removeAllChildren();for(var i=0,child;child=obj.childNodes[i];i++){this.appendChild(js.lsn.ext.wireframe.data.fromObject(child));}
return this;};});js.extend('lsn.ext.wireframe.data',function(js){var CNode=this.Node;this.DocumentNode=function(typeName){CNode.apply(this);this.tagName='DOCUMENT';};var _proto=this.DocumentNode.prototype=js.lang.createMethods(CNode);_proto.toString=function(){return this.tagName;};});js.extend('lsn.ext.wireframe.data',function(js){var CNode=this.Node;this.HTMLElementNode=function(typeName){CNode.apply(this);this.tagName=typeName.toUpperCase();};var HTMLElementNode=this.HTMLElementNode.prototype=js.lang.createMethods(CNode);HTMLElementNode.toString=function(){return this.tagName;};js.lsn.ext.wireframe.data.register('a',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('abbr',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('acronym',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('address',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('applet',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('area',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('b',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('base',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('basefont',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('bdo',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('big',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('blockquote',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('body',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('br',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('button',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('caption',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('center',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('cite',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('code',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('col',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('colgroup',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('dd',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('del',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('dfn',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('dir',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('div',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('dl',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('dt',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('em',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('fieldset',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('font',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('form',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('frame',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('frameset',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('h1',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('h2',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('h3',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('h4',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('h5',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('h6',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('head',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('hr',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('html',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('i',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('iframe',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('img',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('input',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('ins',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('isindex',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('kbd',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('label',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('legend',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('li',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('link',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('map',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('menu',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('meta',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('noframes',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('noscript',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('object',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('ol',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('optgroup',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('option',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('p',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('param',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('pre',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('q',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('s',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('samp',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('script',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('select',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('small',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('span',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('strike',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('strong',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('style',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('sub',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('sup',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('table',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('tbody',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('td',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('textarea',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('tfoot',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('th',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('thead',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('title',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('tr',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('tt',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('u',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('ul',this.HTMLElementNode);js.lsn.ext.wireframe.data.register('var',this.HTMLElementNode);});js.extend('lsn.ext.wireframe.ui',function(js){var CAction=js.action.ActionDispatcher;this.Fragment=function(app,elemId){CAction.apply(this);this.app=app;this.elemId=elemId;this.ui=new Object();this.app.addActionListener('onPageLoad',this.attach,this);};var Fragment=this.Fragment.prototype=js.lang.createMethods(CAction);Fragment.attach=function(){function walk(node,cb){js.lang.callback(cb,null,[node]);if(node.hasChildNodes()){var child=node.firstChild;while(child){walk(child,cb);child=child.nextSibling;}}}
var rootElement=js.dom.getElement(this.elemId);walk(rootElement,[this.attachElement,this]);};Fragment.attachElement=function(elem){if(!js.dom.node.isElement(elem))return;if(elem.tagName=='BUTTON'){var value=js.dom.getAttribute(elem,'value');if(value){var parts=value.match(/^action:(.*)/);if(parts){this.clickToAction(elem,parts[1]);}}}
var id=js.dom.getAttribute(elem,'id');if(!id)return;if(this.ui[id])throw'Element ID is not unique: '+id;this.ui[id]=elem;};Fragment.clickToAction=function(elem,name){new js.dom.EventListener(elem,'click',function(event,name){js.dom.stopEvent(event);this.dispatchClassAction(name);},this,[name]);};});js.extend('lsn.ext.wireframe.ui',function(js){var CNode=js.lsn.ext.wireframe.data.Node;var CAction=js.action.ActionDispatcher;this.View=function(app){CAction.apply(this);this.app=app;this.root=app.root;js.action.addActionListener(CNode,'onAdopt',this.onAdopt,this);js.action.addActionListener(CNode,'onOrphan',this.onOrphan,this);app.addActionListener('onPageLoad',this.onPageLoad,this);app.addView(this);};var _proto=this.View.prototype=js.lang.createMethods(CAction);_proto.onPageLoad=function(){};_proto.onAdopt=function(action,node){};_proto.onOrphan=function(action,node){};});js.extend('lsn.ext.wireframe.ui',function(js){var CAction=js.action.ActionDispatcher;this.ListItem=function(node){CAction.apply(this);this.node=node;};var _proto=this.ListItem.prototype=js.lang.createMethods(CAction);_proto.getUI=function(){return this.uiRoot||this.createUI();};_proto.createUI=function(){this.uiAnchor=js.dom.createElement('a',{innerHTML:this.node.tagName});this.uiRoot=js.dom.createElement('tr',['td',[this.uiAnchor]]);function noop(event){js.dom.stopEvent(event);return false;}
this.uiEvents=[new js.dom.EventListener(this.uiAnchor,'click',this.onClick,this),new js.dom.EventListener(this.uiAnchor,'dblclick',this.onDblClick,this),new js.dom.EventListener(this.uiAnchor,'select',noop),new js.dom.EventListener(this.uiAnchor,'selectstart',noop),new js.dom.EventListener(this.uiAnchor,'mousedown',noop),];this.updateUI();return this.uiRoot;};_proto.updateUI=function(){var indent=8*this.node.getDepth();js.dom.setStyle(this.uiAnchor,'padding-left',indent+'px');};_proto.destroyUI=function(){for(var i=0,evt;evt=this.uiEvents[i];i++){evt.remove();}
this.uiEvents=[];};_proto.onClick=function(event){js.dom.stopEvent(event);this.select();}
_proto.onDblClick=function(event){js.dom.stopEvent(event);if(js.dom.browser.isOpera)js.dom.clearSelection();}
_proto.select=function(){js.dom.addClassName(this.uiRoot,'selected');this.executeAction('onSelect',this);};_proto.deselect=function(){js.dom.removeClassName(this.uiRoot,'selected');this.executeAction('onDeselect',this);};_proto.destroy=function(){if(this.uiRoot)js.dom.removeElement(this.uiRoot);this.destroyUI();};});js.extend('lsn.ext.wireframe.ui',function(js){var CView=js.lsn.ext.wireframe.ui.View;var CItem=js.lsn.ext.wireframe.ui.ListItem;this.ListView=function(app){CView.apply(this,arguments);this.items=[];this.selected=undefined;js.action.addActionListener(CItem,'onSelect',this.onSelect,this);js.action.addActionListener(CItem,'onDeselect',this.onDeselect,this);js.action.addActionListener(CItem,'onExpand',this.onExpand,this);js.action.addActionListener(CItem,'onCollapse',this.onCollapse,this);app.addActionListener('onCreateNode',this.onCreateNode,this);app.addActionListener('onDeleteNode',this.onDeleteNode,this);};var _proto=this.ListView.prototype=js.lang.createMethods(CView);_proto.onPageLoad=function(){var buttons=js.dom.getElementsByTagName(js.dom.getElement('ListButtons'),'BUTTON');for(var i=0,btn;btn=buttons[i];i++){js.dom.addEventListener(btn,'click',this.onButtonClick,this);}
this.uiRoot=js.dom.getElement('ListView');this.uiTBody=js.dom.createElement('tbody');this.uiRoot.appendChild(this.uiTBody);this.createItem(app.root);this.uiTypeName=js.dom.getElement('typeName');var options=[]
var allowed=js.lsn.ext.wireframe.data.getAllowedTypes().sort();for(var idx in allowed){options.push(js.dom.createElement('option',{value:allowed[idx],innerHTML:allowed[idx]}));}
js.dom.replaceChildren(this.uiTypeName,options);};_proto.onButtonClick=function(event){js.dom.stopEvent(event);var btn=js.dom.getEventTarget(event);var cmd=js.dom.getAttribute(btn,'value');var values={};if(btn.parentNode.tagName=='FORM'){values=js.dom.getValues(btn.parentNode);}
this.app.exec(cmd,values);};_proto.onCreateNode=function(action,node){this.select(node);};_proto.onDeleteNode=function(action,node,altNode){try{if(altNode)this.select(altNode);}catch(ex){}};_proto.newItem=function(node){var item=this.items[node.id]=new CItem(node);return item;};_proto.onAdopt=function(action,node){CView.prototype.onAdopt.apply(this,arguments);this.createItem(node);}
_proto.createItem=function(node){var item=this.newItem(node);var prevItem=undefined;var nextItem=undefined;if(node.previousSibling){var id=node.previousSibling.id;var n=node.previousSibling;while(n.lastChild){n=n.lastChild;id=n.id;}
prevItem=this.items[id];}else if(node.parentNode){prevItem=this.items[node.parentNode.id];}
if(prevItem){js.dom.insertAfter(item.getUI(),prevItem.getUI());}else{js.dom.appendChild(this.uiTBody,item.getUI());}
for(var i=0,childNode;childNode=node.childNodes[i];i++){if(this.items[childNode.id])this.removeItem(childNode);this.createItem(childNode);}};_proto.onOrphan=function(action,node){CView.prototype.onOrphan.apply(this,arguments);this.removeItem(node);}
_proto.removeItem=function(node){var item=this.items[node.id];if(item){if(item===this.selected){item.deselect();}
item.destroy();delete this.items[node.id];for(var i=0,childNode;childNode=node.childNodes[i];i++){this.removeItem(childNode);}}};_proto.select=function(node){var id=node.id;var item=this.items[id];if(!item)throw'Cannot select item: '+id+' not found';item.select();};_proto.onSelect=function(action,item){if(this.selected&&this.selected!==item){this.selected.deselect();}
this.selected=item;this.executeAction('onSelect',item.node);};_proto.onDeselect=function(action,item){this.selected=undefined;if(item.node)this.executeAction('onDeselect',item.node);};_proto.onExpand=function(action,item){};_proto.onCollapse=function(action,item){};});js.extend('lsn.ext.wireframe.ui',function(js){var CView=js.lsn.ext.wireframe.ui.View;this.DebugView=function(app){CView.apply(this,arguments);};var _proto=this.DebugView.prototype=js.lang.createMethods(CView);_proto.onPageLoad=function(){this.uiRoot=js.dom.getElement('DebugView');};_proto.onAdopt=function(action,node){CView.prototype.onAdopt.apply(this,arguments);this.refresh();};_proto.onOrphan=function(action,node){CView.prototype.onOrphan.apply(this,arguments);this.refresh();};_proto.refresh=function(){var str='';this.root.walk(function(node){for(var i=1;i<node.getDepth();i++){str+='  ';}
str+=node.toString()+"\n";});js.dom.setValue(this.uiRoot,str);};});js.extend('lsn.ext.wireframe.ui',function(js){var CAction=js.action.ActionDispatcher;this.EditView=function(app){CAction.apply(this);this.app=app;this.app.addActionListener('onPageLoad',this.onPageLoad,this);this.app.addActionListener('onSelectNode',this.onSelect,this);this.app.addActionListener('onDeselectNode',this.onDeselect,this);this.app.addView(this);};var _proto=this.EditView.prototype=js.lang.createMethods(CAction);_proto.onPageLoad=function(){this.uiRoot=js.dom.getElement('EditView');};_proto.onSelect=function(action,node){var msg='Edit this element: '+node.id;js.dom.setValue(this.uiRoot,msg);};_proto.onDeselect=function(action,node){js.dom.removeChildren(this.uiRoot);};});js.extend('lsn.ext.wireframe.ui',function(js){this.Switcher=function(app){this.app=app;this.items=[];this.selected=null;app.addActionListener('onPageLoad',this.attach,this);};var Switcher=this.Switcher.prototype=js.lang.createMethods();Switcher.addView=function(targetId,handleId){this.items.push([targetId,handleId]);};Switcher.attach=function(action){if(this.items.length){for(var i=0,item;item=this.items[i];i++){new js.dom.EventListener(item[1],'click',this.onSwitchView,this,[i]);}
this.select(0);}};Switcher.onSwitchView=function(event,index){js.dom.stopEvent(event);this.select(index);};Switcher.select=function(index){if(this.selected!==null){var item=this.items[this.selected];js.dom.setStyle(item[0],'visibility','hidden');js.dom.removeClassName(item[1],'selected');}
var item=this.items[index];js.dom.setStyle(item[0],'visibility','visible');js.dom.addClassName(item[1],'selected');this.selected=index;};});js.extend('lsn.ext.wireframe.app',function(js){var CApplication=js.lsn.app.Application;this.Application=function(){CApplication.apply(this);this.root=new js.lsn.ext.wireframe.data.RootNode();};var Application=this.Application.prototype=js.lang.createMethods(CApplication);Application.commands={};Application.exec=function(cmd,values){var func=this.commands[cmd];if(!func)throw'Unknown command: '+cmd;func.apply(this,[values]);};});js.extend('lsn.ext.wireframe.app',function(js){var CApp=js.lsn.ext.wireframe.app.Application;this.Editor=function(){CApp.apply(this);this.views=[];this.selected=this.root;};var _proto=this.Editor.prototype=js.lang.createMethods(CApp);_proto.addView=function(view){this.views.push(view);view.addActionListener('onSelect',this.onSelect,this);view.addActionListener('onDeselect',this.onDeselect,this);};_proto.onSelect=function(action,node){this.selected=node;this.executeAction('onSelectNode',node);};_proto.onDeselect=function(action,node){this.selected=undefined;this.executeAction('onDeselectNode',node);};_proto.createNode=function(typeName){return js.lsn.ext.wireframe.data.createInstance(typeName);};_proto.commands.createBefore=function(values){if(!this.selected)throw'No node selected';var parentNode=this.selected.parentNode;var newNode=this.createNode(values.typeName);if(parentNode){parentNode.insertBefore(newNode,this.selected);}else{this.selected.appendChild(newNode);}
this.executeAction('onCreateNode',newNode);};_proto.commands.createChild=function(values){if(!this.selected)throw'No node selected';var parentNode=this.selected;var newNode=this.createNode(values.typeName);parentNode.appendChild(newNode);this.executeAction('onCreateNode',newNode);};_proto.commands.createParent=function(values){if(!this.selected)throw'No node selected';var newNode=this.createNode(values.typeName);var parentNode=this.selected.parentNode;if(parentNode){if(this.selected.previousSibling){parentNode.insertAfter(newNode,this.selected.previousSibling);}else if(this.selected.nextSibling){parentNode.insertBefore(newNode,this.selected.nextSibling);}else{parentNode.appendChild(newNode);}
newNode.appendChild(this.selected);}else{this.selected.appendChild(newNode);}
this.executeAction('onCreateNode',newNode);};_proto.commands.createAfter=function(values){if(!this.selected)throw'No node selected';var parentNode=this.selected.parentNode;var newNode=this.createNode(values.typeName);if(parentNode){parentNode.insertAfter(newNode,this.selected);}else{this.selected.appendChild(newNode);}
this.executeAction('onCreateNode',newNode);};_proto.commands.deleteCurrent=function(){if(!this.selected)throw'No node selected';var node=this.selected;if(node&&node.parentNode){var altNode=node.firstChild||node.nextSibling||node.previousSibling||node.parentNode;var childNode=node.firstChild;while(childNode){node.parentNode.insertAfter(childNode,node);childNode=node.firstChild;}
node.parentNode.removeChild(node);this.executeAction('onDeleteNode',node,altNode);}};_proto.commands.deleteRecursive=function(){if(!this.selected)throw'No node selected';var node=this.selected;if(node&&node.parentNode){var altNode=node.nextSibling||node.previousSibling||node.parentNode;node.parentNode.removeChild(node);this.executeAction('onDeleteNode',node,altNode);}};});